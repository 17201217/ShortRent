<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>修改</title>
<link rel="stylesheet" href="css/system/changepwd.css" />
</head>
<body>
	<div class="body">
		<div class="body_count">
			<div class="login_count">
				<div class="login_count_a">
					<div id="all">
						<div class="login_account_count">
							<span>输入账号</span>
							<input type="text" class="mobile_input" placeholder="请输入账号" id="i1" />
						</div>

						<div class="login_account_count">
							<span>输入密码</span>
							<input type="password" class="mobile_input" placeholder="请输入密码" id="i2" />
						</div>

						<div class="login_account_count">
							<span>确认密码</span>
							<input type="password" class="mobile_input" placeholder="请再次输入密码" id="i3" />
						</div>

						<div class="login_account_counts">
							<span>验证码</span>
							<input type="text" class="vercode" placeholder="请输入邮箱验证码" id="i4"/>
							<input class="account_code" type="button" id="mail" value="获取验证码" />
						</div>
						
						<button class="login_account_button" id="btu">确定</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
	<script>
        var code;
        $(document).ready(function () {
            $("#btu").click(function (e) {
				if($("#i1").val().trim()=="" || $("#i2").val().trim()=="" || $("#i3").val().trim()==""){
                    alert("请填写所有输入框")
                }else if($("#i2").val().trim() != $("#i3").val().trim()){
					alert("两次密码不一致")
				}else if(code != $("#i4").val()){
					alert("验证码错误")
				}else{
					$.ajax({
						type: "post",
						url: "https://localhost:8080/api/v1/system/changepwd",
						data: {
							"user_id": $("#i1").val(),
							"user_password": $("#i2").val()
						},
						success : function(response){
							alert("修改成功")
							window.history.back();
						},
						error : function(response){
							alert("修改失败")
						}
					});
				}
            });
        });

        
        $(document).ready(function () {
            $("#mail").click(function (e) {
                $("#mail").attr("disabled",true)
                $.ajax({
                    type: "get",
                    url: "https://localhost:8080/api/v1/mail/sendMail/" + $("#i1").val(),
                    success : function(response){
                        code = response  
                        alert("验证码发送成功")
                    },
                    error : function(response){
                        alert("验证码发送失败")
                    },
                    complete : function(response){
                        $("#mail").attr("disabled",false)
                    }
                });    
            });
        });
        
        $(document).ready(function(){
            $("#btu").mouseenter(function(){
                $("#btu").css("background-color","#34D8DE");
			});
			$("#btu").mouseleave(function(){
                $("#btu").css("background-color"," #40E4E5");
			});
			$("#mail").mouseenter(function(){
                $("#mail").css("background-color","#34D8DE");
			});
			$("#mail").mouseleave(function(){
                $("#mail").css("background-color"," #40E4E5");
            });
        });
    </script>
</body>
</html>
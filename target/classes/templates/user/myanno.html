<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>我的通知</title>
<link rel="stylesheet" href="css/user/mycollect.css" />
</head>

<body>
	<input type="text" id="i1" th:value="${session.user_id}" hidden="true"><br /> 

    <div class="t">
        <table>
        </table>
    </div>
	
	<div class="btu">
        <button id="btu_up" class="btu1">&lt;</button>
        &nbsp;<span id="span1">1</span><span>/</span><span id="span2">-</span>&nbsp;
        <button id="btu_down" class="btu1">&gt;</button>
    </div>
	
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
    <script>
    	var page
        $(document).ready(function () {
            let str = `<tr><th>通知编号</th><th>通知内容</th><th>通知发布时间</th></tr>`
            $.ajax({
                type: "get",
                url: "https://localhost:8080/api/v1/announcement/announcements",
                success: function (response) {
                    let annos = response;
                    if (annos.length == 0) {
                        str += `<tr><td colspan="3">暂无通知</td></tr>`
                    } else {
                    	annos.forEach(announcement => {
                    		//将日期格式转化为正确的格式
                    		var anno_time = announcement.anno_time;
                    		var anno = new Array();
                    		anno = anno_time.split("+");
                    		console.log(anno[0]);
                    		anno_time = anno[0].replace("T"," ");
                    		var len = anno_time.length;                  		
                    		anno_time = anno_time.substring(0,len-4);                   		
                    		console.log(anno_time);
                            str += `<tr><td>${announcement.anno_id}</td><td>${announcement.message}</td>
                                    <td>${anno_time}</td></tr>`;
                        });
                    }
                    $("table").html(str);
                }
            });
        });
	
    	
    	$(document).ready(function () {
            $.ajax({
                type: "get",
                url: "https://localhost:8080/api/v1/announcement/getcount/",
                success: function (response) {
                	if(response % 10==0 && response!=0)
                		page = parseInt(response / 10);
                	else
                    	page = parseInt(response / 10) + 1
                    $("#span2").text(page);
                },
                error: function (response) {
                    alert("查询失败")
                }
            });
        });
    	
    	$(document).ready(function () {
            $("#btu_down").click(function (e) {
                if (parseInt($("#span1").text()) >= page) {
                    alert("这是最后一页")
                } else {
                    $("#span1").text(parseInt($("#span1").text()) + 1);
                    var curpage_down = $("#span1").text();
                    let str = `<tr><th>通知编号</th><th>通知内容</th><th>通知发布时间</th></tr>`
                    $.ajax({
                        type: "get",
                        url: "https://localhost:8080/api/v1/announcement/announcements?start=" + (curpage_down - 1) * 10,
                        success: function (response) {
                            let annos = response;
                            if (annos.length == 0) {
                                str += `<tr><td colspan="3">暂无通知</td></tr>`
                            } else {
                            	annos.forEach(announcement => {
                            		str += `<tr><td>${announcement.anno_id}</td><td>${announcement.message}</td>
                                        <td>${announcement.anno_time}</td></tr>`;
                                });
                            }
                            $("table").html(str);
                        }
                    });
                }
            });
        });
    	
    	$(document).ready(function () {
            $("#btu_up").click(function (e) {
                if (parseInt($("#span1").text()) <= 1) {
                    alert("这是第一页")
                } else {
                    $("#span1").text(parseInt($("#span1").text()) - 1);
                    var curpage_up = $("#span1").text();
                    let str = `<tr><th>通知编号</th><th>通知内容</th><th>通知发布时间</th></tr>`
                    $.ajax({
                        type: "get",
                        url: "http://localhost:8080/api/v1/announcement/announcements?start=" + (curpage_up - 1) * 10,
                        success: function (response) {
                            let annos = response;
                            if (annos.length == 0) {
                                str += `<tr><td colspan="3">暂无通知</td></tr>`
                            } else {
                                annos.forEach(announcement => {
                                	str += `<tr><td>${announcement.anno_id}</td><td>${announcement.message}</td>
                                        <td>${announcement.anno_time}</td></tr>`;
                                });
                            }
                            $("table").html(str);
                        }
                    });
                }
            });
        });
    </script>
</body>

</html>
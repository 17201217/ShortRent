<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>短租网网站</title>
    <link rel="shortcut icon" href="" />
    <link rel="stylesheet" href="css/system/index.css" />
</head>
<body>
<!--顶部-->
<div class="header">
    <div class="width1190">
        <!--顶部左边区域-->
        <div class="fl">您好，欢迎来到短租网平台!</div>
        <!--顶部右边区域-->
        <div class="fr">
            <div th:if="${session.user_id == null}">
                <p><a href="/login">登陆</a>|<a href="/registered">注册</a></p>
            </div>

            <div th:if="${session.user_id != null}">
                <p>欢迎您，<a href="/user"><span th:text="${session.user_id}"></span></a>,<a href="/">注销</a></p>
            </div>
        </div>
    </div>
</div>

<!--搜索与输入框-->
<div class="find">
    <input type="text" id="text1" class="inp2" placeholder="请输入地点或名称">
    <input type="button" value="搜索" id="plore" class="btu1">
</div>
<!--定义所有选择区域选中元素标签为choose-->
<div class="content">
    <div class="width1190">
        <form action="#" method="get" class="pro-search">
            <input type="hidden" id="positionp">
            <input type="hidden" id="pricep">
            <input type="hidden" id="sizes">
            <input type="hidden" id="typet">
            <input type="hidden" id="DESCorASC">
            <table id="tablet">
                <tr>
                    <th>选择区域：</th>
                    <td id="td1">
                        <a href="#" class="pro-cur">不限</a>
                        <a href="#">南昌</a>
                        <a href="#">九江</a>
                        <a href="#">上饶</a>
                        <a href="#">鹰潭</a>
                    </td>
                </tr>
                <tr>
                    <th>选择价格：</th>
                    <td id="td2">
                        <a href="#" class="pro-cur">不限</a>
                        <a href="#">500-1000</a>
                        <a href="#">1000-2000</a>
                        <a href="#">2001-3000</a>
                        <a href="#">3001-4000</a>
                        <input type="text" class="protext" id="inputprice1" /> - <input type="text" class="protext"
                                                                                        id="inputprice2" />元
                        <a id="inputprice" href="#">确定</a>
                    </td>
                </tr>
                <tr>
                    <th>房屋大小：</th>
                    <td id="td3">
                        <a href="#" class="pro-cur">不限</a>
                        <a href="#">10-20㎡</a>
                        <a href="#">21-40㎡</a>
                        <a href="#">41-60㎡</a>
                        <a href="#">61-80㎡</a>
                        <a href="#">81-99㎡</a>
                        <a href="#">100㎡及以上</a>
                    </td>
                </tr>
                <tr>
                    <th>房屋户型：</th>
                    <td id="td4">
                        <a href="#" class="pro-cur">不限</a>
                        <a href="#">一室一厅</a>
                        <a href="#">两室一厅</a>
                        <a href="#">两室两厅</a>
                        <a href="#">三室一厅</a>
                    </td>
                </tr>
                <tr>
                    <th>排序方式：</th>
                    <td id="td5">
                        <a href="#" class="pro-cur" id="td5a1">默认</a>
                        <a href="#" id="td5a2">价格↑</a>
                        <a href="#" id="td5a3">价格↓</a>
                        <a href="#" id="td5a4">面积↑</a>
                        <a href="#" id="td5a5">面积↓</a>
                    </td>
                </tr>
            </table>
        </form>
    </div>
    <!--width1190-->
</div>
<div class="count">
</div><br><br>
<!--动态生成房源信息，初始化加载-->
<div class="show2">
</div>

<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script>
        $(document).ready(function () {
            $.ajax({
                type: "get",
                url: "https://localhost:8080/api/v1/house/simpleHouseList",
                success: function (response) {
                    if (response.length == 0) {
                        $(".show2").empty();
                    } else {
                        let houses = response;
                        houses.forEach(house => {
                            let id = house.house_id;
                            let str = ` <dl class="testdl">
                                            <dt><a href= "/houseDetail?house_id=${id}"><img src="img/rent-img/${house.photo}"/></a></dt>
                                                <dd><div><span>位置：${house.locate}</span></div>
                                                <div>户型：${house.type}</div>
                                                <div>面积：${house.size} 平方</div>
                                        		<div>价格：<span>${house.house_price}</span><span class="font12">元/月</span></div>
                                        		<div class="clears"></div>
                                        		<br /></dd>
                                     	</dl>`;
                            $(".show2").append(str);
                        });
                    }

                }
            });
        });
        /* 获取点击的值*/

        $(document).ready(function () {
            $('#td1 a').click(function () {
                $("#positionp").val($(this).html());
            });
            $('#td2 a').click(function () {
                $("#pricep").val($(this).html());
            });
            $('#td3 a').click(function () {
                $("#sizes").val($(this).html());
            });
            $('#td4 a').click(function () {
                $("#typet").val($(this).html());
            });

            $('#td5a1').click(function () {
                $("#DESCorASC").val("");
            });
            $('#td5a2').click(function () {
                $("#DESCorASC").val("pasc");
            });
            $('#td5a3').click(function () {
                $("#DESCorASC").val("pdesc");
            });
            $('#td5a4').click(function () {
                $("#DESCorASC").val("sasc");
            });
            $('#td5a5').click(function () {
                $("#DESCorASC").val("sdesc");
            });

            $("#inputprice").click(function () {
                var p1 = $("#inputprice1").val();//获取输入框价格左区间
                var p2 = $("#inputprice2").val();//获取输入框价格右区间
                //    console.log(p1+p2);

                //此地方价格输入存在一些bug
                if (isNaN(parseInt(p1)) || isNaN(parseInt(p2))) {
                    alert("输入非法，你不能输入字符串");
                   // $("#pricep").val() == "";
                } else if (parseInt(p1) > parseInt(p2)) {
                    alert("输入区间不合法,请重新输入");
                    //$("#pricep").val() == "";
                }
                else {
                    $("#pricep").val() == p1 + "-" + p2;

                }
            });

        });

        $(document).ready(function () {
            $('#tablet a').click(function () {
                var a = $("#positionp").val();
                var b = $("#pricep").val();
                var c = $("#sizes").val();
                var d = $("#typet").val();
                var e = $("#DESCorASC").val();
                var position = "";
                var price1 = "";
                var price2 = "";
                var size1 = "";
                var size2 = "";
                var type = "";
                var order = "";

                if (e != "") {
                	order = e;
                }

                if (a != "" && a != "不限") {
                    position = a;
                }

                if (b != "" && b != "不限") {
                    var splites = new Array();
                    splites = b.split("-");
                    price1 = splites[0];
                    price2 = splites[1];
                }
                if (c != "" && b != "不限" & c.indexOf("-") != -1) {
                    var splites = new Array();
                    splites = c.split("-");
                    size1 = splites[0];
                    size2 = splites[1].replace("㎡", "");
                }
                if (c == "100㎡及以上") {
                    size1 = 100;
                }
                if (d != "" && d != "不限") {
                    type = d;
                }
                if (b == "确定") {
                    price1 = $("#inputprice1").val();
                    price2 = $("#inputprice2").val();

                    if (isNaN(parseInt(price1)) || isNaN(parseInt(price2))) {
                        price1="";
                        price2="";
                    }
                    if(parseInt(price1)>parseInt(price2)){
                        price1="";
                        price2="";
                    }

                }

                console.log(price2);
                $(document).ready(function () {
                    $.ajax({
                        type: "get",
                        url: "https://localhost:8080/api/v1/house/houseList5",
                        data: {
                            "locate": position,
                            "price1": price1,
                            "price2": price2,
                            "size1": size1,
                            "size2": size2,
                            "type": type,
                            "descorasc": order
                        },
                        success: function (response) {
                            if (response.length == 0) {
                                $(".show2").empty();
                                $(".count").empty();
                                $(".count").append("共找到0套符合条件的租房房源");
                            } else {
                                let houses = response;
                                $(".show2").empty();
                                $(".count").empty();
                                let num = 0;
                                houses.forEach(house => {
                                    let id = house.house_id;
                                    num++;
                                    let str = ` <dl class="testdl">
				                                    <dt><a href= "/houseDetail?house_id=${id}"><img src="img/rent-img/${house.photo}"/></a></dt>
				                                        <dd><div><span>位置：${house.locate}</span></div>
				                                        <div>户型：${house.type}</div>
				                                        <div>面积：${house.size} 平方</div>
				                                		<div>价格：<span>${house.house_price}</span><span class="font12">元/月</span></div>
				                                		<div class="clears"></div>
				                                		<br /></dd>
				                             	</dl>`;

                                    $(".show2").append(str);
                                });
                                $(".count").append("共找到"+num+"套符合条件的租房房源");
                            }

                        }
                    });

                });


            })
        });
        $(document).ready(function () {
            $("#plore").click(function () {
                var inputThing = $("#text1").val();
                console.log(inputThing);
                $(document).ready(function () {
                    $.ajax({
                        type: "get",
                        url: "https://localhost:8080/api/v1/house/houseList6",
                        data: {
                            "inputParam": inputThing,
                        },
                        success: function (response) {
                            if (response.length == 0) {
                                $(".show2").empty();
                                $(".count").empty();
                                $(".count").append("共找到0套符合条件的租房房源");
                            } else {
                                let houses = response;
                                $(".show2").empty();
                                $(".count").empty();
                                let num = 0;
                                houses.forEach(house => {
                                    let id = house.house_id;
                                    num++;
                                    let str = ` <dl class="testdl">
				                                    <dt><a href= "/houseDetail?house_id=${id}"><img src="img/rent-img/${house.photo}"/></a></dt>
				                                        <dd><div><span>位置：${house.locate}</span></div>
				                                        <div>户型：${house.type}</div>
				                                        <div>面积：${house.size} 平方</div>
				                                		<div>价格：<span>${house.house_price}</span><span class="font12">元/月</span></div>
				                                		<div class="clears"></div>
				                                		<br /></dd>
				                             	</dl>`;
                                    $(".show2").append(str);
                                });
                                $(".count").append("共找到"+num+"套符合条件的租房房源");
                            }

                        }
                    });

                });
            });

        });
		
        $('#td1 a').click(function(){
        	$('#td1 a').each(function(){
           		$(this).removeClass("pro-cur");//还原所有td的颜色
            });
        	$(this).addClass("pro-cur");//设置点击td的颜色
        });
        $('#td2 a').click(function(){
        	$('#td2 a').each(function(){
           		$(this).removeClass("pro-cur");//还原所有td的颜色
            });
        	$(this).addClass("pro-cur");//设置点击td的颜色
        });
        $('#td3 a').click(function(){
        	$('#td3 a').each(function(){
           		$(this).removeClass("pro-cur");//还原所有td的颜色
            });
        	$(this).addClass("pro-cur");//设置点击td的颜色
        });
        $('#td4 a').click(function(){
        	$('#td4 a').each(function(){
           		$(this).removeClass("pro-cur");//还原所有td的颜色
            });
        	$(this).addClass("pro-cur");//设置点击td的颜色
        });
        $('#td5 a').click(function(){
        	$('#td5 a').each(function(){
           		$(this).removeClass("pro-cur");//还原所有td的颜色
            });
        	$(this).addClass("pro-cur");//设置点击td的颜色
        });
    </script>


</body>


</body>
</html>